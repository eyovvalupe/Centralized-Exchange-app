<template>
  <div class="wallet_container">
    <div v-if="from == 'cash'">
      <DefaultWallet v-model:showInfo="showInfo" :name="t('assets.wallet_cash_balance')" type="cash" />
      <Btns />
      <Cash :showInfo="showInfo" @click="(val) => click(val)" />
    </div>
    <div v-if="from == 'stock'">
      <DefaultWallet v-model:showInfo="showInfo" :name="t('assets.wallet_stock_balance')" type="stock" />
      <Btns />
      <StockWallet :showInfo="showInfo" @click="(val) => click(val)" />
    </div>
    <div v-if="from == 'futures'">
      <DefaultWallet v-model:showInfo="showInfo" :name="t('assets.wallet_contract_balance')" type="futures" />
      <Btns />
      <CryptoWallet :showInfo="showInfo" @click="(val) => click(val)" />
    </div>

  </div>
</template>
<script setup>
import { ref, onMounted, computed, watch } from "vue";
import DefaultWallet from "./components/DefaultWallet.vue";
import Btns from "./components/Btns.vue";
import Cash from "./Cash.vue";
import store from "@/store";
import StockMyWallet from "./StockWallet.vue";
import CryptoWallet from "./CryptoWallet.vue";
import HeaderTabs from "@/components/HeaderTabs.vue";
import { useI18n } from "vue-i18n";
import StockWallet from "./StockWallet.vue";
const showInfo = ref(true)

const emits = defineEmits(['click'])
const props = defineProps({
  from: {
    type: String,
    default: 'cash'
  }
})
const { t } = useI18n();
const currSelectedWallet = computed(() => store.state.currSelectedWallet);
const activeTab = ref(currSelectedWallet.value);
console.log(currSelectedWallet.value)

const changeActiveTab = (val) => {
  showData.value = false;
  activeTab.value = val;
  store.commit("setCurrSelectedWallet", val);
  store.dispatch("updateWallet", val);
  store.dispatch("updateAssets");
};
// 刷新总资产
const assets = computed(() => store.state.assets || {});
const token = computed(() => store.state.token || "");
const showData = ref(false);
const toggleShow = (val) => {
  showData.value = val;
};

const getAssets = () => {
  if (!token.value) return;
  store.dispatch("updateAssets");
  store.dispatch("updateWallet");
};

const refresh = () => {
  getAssets();
};

const click = (val) => {
  emits('click', val)
}

defineExpose({
  refresh,
});

watch(
  currSelectedWallet,
  (val) => {
    if (currSelectedWallet.value != activeTab.value) {
      changeActiveTab(val);
    }
  }
);
const jump = (name, check = false, query) => {
  router.push({
    name,
    query,
  });
};
onMounted(() => {
  store.dispatch('updateAssets');
  store.dispatch('updateWallet');
})
</script>

<style lang="less" scoped>
.wallet_container {
  width: 7.5rem;

  :deep(> .van-tabs > .van-tabs__wrap) {
    margin: 0 0.4rem 0.32rem 0.4rem;
  }

}
</style>
